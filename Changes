Revision history for File::DataClass

0.1.47   2009-10-16
         - Started this log

package File::DataClass::Schema;

has 'path' => isa => 'F_DC_IO_Object', required => TRUE;
has 'result_source_attributes' => isa => 'HashRef' => default => sub {
   return { file1 => { attributes => [], defaults => {}, ...
                       storage_attributes => {}, storage_class => q(),
                       resultset_class => q(), resultset_attributes => {}, },
            file2 => {},
   };
};
has 'result_source_class';
has 'sources' => lazy_build => 1;

sub connect {
   my ($self, $path) = @_; my $class = blessed $self || $self;

   return $class->new( path => $class->io( $path ) );
}

sub _build_sources {
   my $self = shift; my $sources = {};

   for my $file in (keys %{ $self->result_source_attributes }) {
      my $attrs = $self->result_source_attributes->{ $file };

      $attrs->{path} = $self->io( $self->catfile( $self->path, $file ) );
      $attrs->{schema} = $self;

      $sources->{ $file } = $self->result_source_class->new( $attrs );
   }

   return $sources;
}

sub resultset {
   my ($self, $source) = @_; return $self->sources->{ $source }->resultset;
}

package File::DataClass::ResultSource;

has 'attributes';
has 'defaults';
has 'element';
has 'label_attr';
has 'path';
has 'resultset_attributes';
has 'resultset_class';
has 'schema' => weak_ref => TRUE;
has 'storage_attributes';
has 'storage_class';
has 'storage' => lazy_build => TRUE;

sub _build_storage {
   my $self = shift;

   return $self->storage_class->new( $self->storage_attributes );
}

sub resultset {
    my $attrs = $resultset_attributes;

    $attrs->{source} = $self;

    return $self->resultset_class->new( $attrs );
}

package File::DataClass::ResultSet;

has 'source' => weak_ref => TRUE;
